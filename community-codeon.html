<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>CODEON Africa Championship</title>

<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>

<style>
body{
  font-family:Arial;
  margin:0;
  background:#f4f4f4;
  transition:0.3s;
}
.dark{
  background:#111;
  color:white;
}
header{
  background:black;
  color:white;
  padding:15px;
  text-align:center;
}
button{
  padding:8px 15px;
  margin:5px;
  cursor:pointer;
}
textarea{
  width:100%;
  height:150px;
}
section{
  padding:20px;
}
.leader-row{
  display:flex;
  justify-content:space-between;
  padding:6px;
  border-bottom:1px solid #ccc;
  transition:0.3s;
}
.leader-row:hover{transform:scale(1.02);}
.highlight{
  background:gold;
}
.badge{
  padding:3px 6px;
  border-radius:4px;
  font-size:12px;
  animation:pulse 1s infinite;
}
.gold{background:gold;}
.silver{background:silver;}
.bronze{background:#cd7f32;color:white;}
@keyframes pulse{
  0%{opacity:1;}
  50%{opacity:0.6;}
  100%{opacity:1;}
}
.card{
  background:white;
  padding:15px;
  margin-bottom:15px;
  border-radius:8px;
}
.dark .card{background:#222;}
</style>
</head>
<body>

<header>
<h1>üåç CODEON Africa Championship</h1>
<button onclick="toggleMode()">Toggle Dark/Light</button>
<button onclick="logout()">Logout</button>
</header>

<section id="authSection">
<h2>Login / Sign Up</h2>
<input type="email" id="email" placeholder="Email"><br>
<input type="password" id="password" placeholder="Password"><br>
<input type="text" id="school" placeholder="School Name"><br>
<select id="country">
<option value="Uganda">Uganda</option>
<option value="Kenya">Kenya</option>
<option value="Nigeria">Nigeria</option>
<option value="Ghana">Ghana</option>
<option value="South Africa">South Africa</option>
</select><br>
<button onclick="signup()">Sign Up</button>
<button onclick="login()">Login</button>
</section>

<section id="main" style="display:none;">

<div class="card">
<h2>üî• Weekly Challenge</h2>
<p>Build a landing page for a tech startup.</p>
<textarea id="challengeCode"></textarea>
<button onclick="submitChallenge()">Submit Challenge</button>
</div>

<div class="card">
<h2>ü§ù Peer Review</h2>
<textarea id="reviewText" placeholder="Write review here..."></textarea>
<button onclick="submitReview()">Submit Review</button>
</div>

<div class="card">
<h2>üèÜ Africa Leaderboard</h2>
<div id="leaderboard"></div>
</div>

<div class="card">
<h2>üè´ School Championship</h2>
<div id="schoolBoard"></div>
</div>

<div class="card">
<h2>üåç Country Championship</h2>
<div id="countryBoard"></div>
</div>

<div class="card">
<h2>üìú Certificate</h2>
<div id="certificate"></div>
</div>

</section>

<script>
// üî• FIREBASE CONFIG
const firebaseConfig = {
  apiKey: "AIzaSyD_LR9Kllj7hoKTiJAaSxyHglSO6r5gh-g",
  authDomain: "codeon-3cb1c.firebaseapp.com",
  projectId: "codeon-3cb1c"
};
firebase.initializeApp(firebaseConfig);
const auth=firebase.auth();
const db=firebase.firestore();

let currentUser=null;

// AUTH
function signup(){
  auth.createUserWithEmailAndPassword(email.value,password.value)
  .then(user=>{
    db.collection("users").doc(user.user.uid).set({
      email:email.value,
      school:school.value,
      country:country.value,
      points:0
    });
  });
}

function login(){
  auth.signInWithEmailAndPassword(email.value,password.value);
}

function logout(){
  auth.signOut();
}

auth.onAuthStateChanged(user=>{
  if(user){
    currentUser=user;
    authSection.style.display="none";
    main.style.display="block";
    loadBoards();
  }else{
    authSection.style.display="block";
    main.style.display="none";
  }
});

// WEEKLY CHALLENGE SUBMIT
function submitChallenge(){
  let code=challengeCode.value;

  // AI scoring simulation
  let score = Math.floor(Math.random()*50)+50;

  db.collection("users").doc(currentUser.uid).update({
    points: firebase.firestore.FieldValue.increment(score)
  });

  alert("AI Score: "+score+" points awarded!");
  generateCertificate(score);
}

// PEER REVIEW
function submitReview(){
  db.collection("reviews").add({
    text:reviewText.value,
    user:currentUser.email
  });
  alert("Review Submitted!");
}

// LEADERBOARDS
function loadBoards(){
  db.collection("users").onSnapshot(snapshot=>{
    let users=[];
    snapshot.forEach(doc=>{
      users.push(doc.data());
    });

    users.sort((a,b)=>b.points-a.points);

    renderAfrica(users);
    renderSchool(users);
    renderCountry(users);
  });
}

function renderAfrica(users){
  let html="";
  users.slice(0,30).forEach((u,i)=>{
    let badge="";
    if(u.points>200) badge="<span class='badge gold'>Gold</span>";
    else if(u.points>100) badge="<span class='badge silver'>Silver</span>";
    else badge="<span class='badge bronze'>Bronze</span>";

    html+=`<div class="leader-row">
      ${i+1}. ${u.email} - ${u.points} pts ${badge}
    </div>`;
  });
  leaderboard.innerHTML=html;
}

function renderSchool(users){
  let grouped={};
  users.forEach(u=>{
    grouped[u.school]=(grouped[u.school]||0)+u.points;
  });

  let arr=Object.entries(grouped);
  arr.sort((a,b)=>b[1]-a[1]);

  let html="";
  arr.forEach((s,i)=>{
    html+=`<div>${i+1}. ${s[0]} - ${s[1]} pts</div>`;
  });
  schoolBoard.innerHTML=html;
}

function renderCountry(users){
  let grouped={};
  users.forEach(u=>{
    grouped[u.country]=(grouped[u.country]||0)+u.points;
  });

  let arr=Object.entries(grouped);
  arr.sort((a,b)=>b[1]-a[1]);

  let html="";
  arr.forEach((c,i)=>{
    html+=`<div>${i+1}. ${c[0]} - ${c[1]} pts</div>`;
  });
  countryBoard.innerHTML=html;
}

// CERTIFICATE
function generateCertificate(score){
  certificate.innerHTML=`
    <h3>CODEON Africa Championship Certificate</h3>
    <p>${currentUser.email}</p>
    <p>Awarded ${score} Championship Points</p>
  `;
}

// DARK MODE
function toggleMode(){
  document.body.classList.toggle("dark");
}
</script>

</body>
</html>
