<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>CODEON Africa Championship</title>

<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>

<style>
body{
  font-family:Arial;
  background:linear-gradient(135deg,#0f2027,#203a43,#2c5364);
  color:white;
  margin:0;
}
header{
  text-align:center;
  padding:20px;
  background:black;
}
section{padding:20px;max-width:900px;margin:auto;}
.card{
  background:rgba(255,255,255,0.08);
  padding:20px;
  margin:20px 0;
  border-radius:12px;
}
input,textarea{
  width:100%;
  padding:10px;
  margin:8px 0;
  border-radius:6px;
  border:none;
}
button{
  padding:10px 15px;
  background:gold;
  border:none;
  border-radius:6px;
  font-weight:bold;
  cursor:pointer;
}
.leader-row{
  display:flex;
  justify-content:space-between;
  padding:6px;
  border-bottom:1px solid rgba(255,255,255,.2);
}
.badge{
  background:gold;
  color:black;
  padding:3px 6px;
  border-radius:5px;
  font-size:12px;
}
.error{color:red;}
</style>
</head>
<body>

<header>
<h1>üèÜ CODEON Africa Championship</h1>
<div id="countdown"></div>
</header>

<section id="authSection">
<div class="card">
<h2>Login / Sign Up</h2>
<input type="email" id="email" placeholder="Email">
<input type="password" id="password" placeholder="Password">
<button onclick="signup()">Sign Up</button>
<button onclick="login()">Login</button>
<p id="authError" class="error"></p>
</div>
</section>

<section id="main" style="display:none;">

<div class="card">
<h2>Your Dashboard</h2>
<p id="welcome"></p>
<p>Points: <strong id="points">0</strong></p>
<p>Streak: <strong id="streak">0</strong> üî•</p>
<p>Level: <strong id="level">1</strong></p>
<div id="badges"></div>
<button onclick="logout()">Logout</button>
</div>

<div class="card">
<h2>Weekly Challenge</h2>
<textarea id="challengeCode" placeholder="Write your HTML/CSS..."></textarea>
<button onclick="submitChallenge()">Submit</button>
</div>

<div class="card">
<h2>Leaderboard</h2>
<div id="leaderboard"></div>
</div>

</section>

<script>
// Firebase config
firebase.initializeApp({
  apiKey:"AIzaSyD_LR9Kllj7hoKTiJAaSxyHglSO6r5gh-g",
  authDomain:"codeon-3cb1c.firebaseapp.com",
  projectId:"codeon-3cb1c"
});
const auth=firebase.auth();
const db=firebase.firestore();

let currentUser=null;

// Countdown
function startCountdown(){
  const end=new Date("2026-12-31");
  setInterval(()=>{
    const diff=end-new Date();
    const days=Math.floor(diff/(1000*60*60*24));
    countdown.innerHTML="Championship ends in "+days+" days";
  },1000);
}
startCountdown();

// Signup
function signup(){
  auth.createUserWithEmailAndPassword(email.value,password.value)
  .then(user=>{
    return db.collection("users").doc(user.user.uid).set({
      email:email.value,
      points:0,
      streak:0,
      lastSubmit:null,
      level:1
    });
  })
  .catch(e=>authError.innerText=e.message);
}

// Login
function login(){
  auth.signInWithEmailAndPassword(email.value,password.value)
  .catch(e=>authError.innerText=e.message);
}

// Logout
function logout(){
  auth.signOut();
}

// Auth state
auth.onAuthStateChanged(user=>{
  if(user){
    currentUser=user;
    authSection.style.display="none";
    main.style.display="block";
    loadUser();
    loadLeaderboard();
  } else {
    authSection.style.display="block";
    main.style.display="none";
  }
});

// AI scoring
function calculateScore(code){
  let score=50;
  if(code.includes("@media")) score+=20;
  if(code.includes("flex")) score+=15;
  if(code.length>500) score+=20;
  return score;
}

function submitChallenge(){
  const score=calculateScore(challengeCode.value);
  const ref=db.collection("users").doc(currentUser.uid);

  ref.get().then(doc=>{
    let data=doc.data();
    let today=new Date().toDateString();
    let streak=data.streak||0;

    if(data.lastSubmit===today){
      alert("Already submitted today!");
      return;
    }

    streak++;
    let newPoints=(data.points||0)+score;
    let level=Math.floor(newPoints/200)+1;

    ref.update({
      points:newPoints,
      streak:streak,
      lastSubmit:today,
      level:level
    });

    alert("You earned "+score+" points!");
  });
}

function loadUser(){
  db.collection("users").doc(currentUser.uid)
  .onSnapshot(doc=>{
    let d=doc.data();
    welcome.innerText="Welcome "+d.email;
    points.innerText=d.points||0;
    streak.innerText=d.streak||0;
    level.innerText=d.level||1;

    let badgeHTML="";
    if(d.points>100) badgeHTML+="<span class='badge'>Rising Star</span> ";
    if(d.points>300) badgeHTML+="<span class='badge'>Elite Coder</span> ";
    if(d.points>600) badgeHTML+="<span class='badge'>Africa Finalist</span>";

    badges.innerHTML=badgeHTML;
  });
}

function loadLeaderboard(){
  db.collection("users")
  .orderBy("points","desc")
  .limit(10)
  .onSnapshot(snapshot=>{
    let html="";
    let i=0;
    snapshot.forEach(doc=>{
      i++;
      let d=doc.data();
      html+=`<div class="leader-row">
        <span>${i}. ${d.email}</span>
        <span>${d.points||0} pts</span>
      </div>`;
    });
    leaderboard.innerHTML=html;
  });
}
</script>

</body>
</html>
