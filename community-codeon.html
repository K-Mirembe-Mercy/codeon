<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>CODEON Africa Championship</title>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>

<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap" rel="stylesheet">

<style>
*{box-sizing:border-box;margin:0;padding:0;}
body{
  font-family:'Inter',sans-serif;
  background:linear-gradient(135deg,#0f2027,#203a43,#2c5364);
  color:white;
  min-height:100vh;
}
header{
  text-align:center;
  padding:25px;
  background:rgba(0,0,0,.8);
  backdrop-filter:blur(10px);
}
header h1{font-size:28px;font-weight:800;}
nav{margin-top:10px;}
nav a{color:white;margin:0 10px;text-decoration:none;font-weight:600;}
nav a:hover{color:gold;}

section{padding:30px;max-width:1100px;margin:auto;}
.card{
  background:rgba(255,255,255,.08);
  padding:25px;
  margin:20px 0;
  border-radius:16px;
  backdrop-filter:blur(12px);
  box-shadow:0 15px 40px rgba(0,0,0,.4);
}

button{
  padding:10px 18px;
  background:linear-gradient(45deg,gold,orange);
  border:none;
  border-radius:8px;
  font-weight:700;
  cursor:pointer;
  margin-top:10px;
}

textarea,input{
  width:100%;
  padding:12px;
  margin:8px 0;
  border-radius:8px;
  border:none;
}

.leader-row{
  display:flex;
  justify-content:space-between;
  padding:8px;
  border-bottom:1px solid rgba(255,255,255,.1);
}

.rank-1{color:gold;font-weight:800;}
.rank-2{color:silver;font-weight:800;}
.rank-3{color:#cd7f32;font-weight:800;}

.badge{
  background:gold;
  color:black;
  padding:4px 8px;
  border-radius:6px;
  font-size:12px;
  margin-right:5px;
}

#countdown{margin-top:10px;font-weight:600;color:gold;}
</style>
</head>
<body>

<header>
<h1>üèÜ CODEON Africa Championship</h1>
<div id="countdown"></div>
<nav>
  <a href="index.html">Home</a>
  <a href="enroll.html">Enroll</a>
  <a href="verify.html">Verify</a>
  <a href="community-codeon.html"></a>
</nav>
</header>

<section id="authSection">
<div class="card">
<h2>Login to Compete</h2>
<input type="email" id="email" placeholder="Email">
<input type="password" id="password" placeholder="Password">
<button onclick="login()">Login</button>
</div>
</section>

<section id="main" style="display:none;">

<div class="card">
<h2>üë§ Your Dashboard</h2>
<p id="welcome"></p>
<p>Points: <strong id="points">0</strong></p>
<p>Streak: <strong id="streak">0</strong> üî•</p>
<div id="badges"></div>
</div>

<div class="card">
<h2>üî• Weekly Challenge</h2>
<p>Build a responsive landing page without using &lt;table&gt; tags.</p>
<textarea id="challengeCode" placeholder="Write your HTML/CSS here..."></textarea>
<button onclick="submitChallenge()">Submit Challenge</button>
</div>

<div class="card">
<h2>üèÜ Africa Leaderboard</h2>
<div id="leaderboard"></div>
</div>

</section>

<script>
// Firebase
const firebaseConfig={
  apiKey:"AIzaSyD_LR9Kllj7hoKTiJAaSxyHglSO6r5gh-g",
  authDomain:"codeon-3cb1c.firebaseapp.com",
  projectId:"codeon-3cb1c"
};
firebase.initializeApp(firebaseConfig);
const auth=firebase.auth();
const db=firebase.firestore();

let currentUser=null;

// Countdown
function startCountdown(){
  const end=new Date("2026-12-31");
  setInterval(()=>{
    const now=new Date();
    const diff=end-now;
    const days=Math.floor(diff/(1000*60*60*24));
    countdown.innerHTML="‚è≥ Championship ends in "+days+" days";
  },1000);
}
startCountdown();

// Login
function login(){
  auth.signInWithEmailAndPassword(email.value,password.value);
}

auth.onAuthStateChanged(user=>{
  if(user){
    currentUser=user;
    authSection.style.display="none";
    main.style.display="block";
    loadUserData();
    loadLeaderboard();
  }
});

// AI-like scoring
function calculateScore(code){
  let score=50;
  if(code.includes("<header>")) score+=10;
  if(code.includes("@media")) score+=15;
  if(code.includes("flex")) score+=10;
  if(code.length>800) score+=20;
  return score;
}

function submitChallenge(){
  const code=challengeCode.value;
  const score=calculateScore(code);

  const userRef=db.collection("users").doc(currentUser.uid);

  userRef.get().then(doc=>{
    let streak=doc.data()?.streak||0;
    streak++;

    userRef.set({
      email:currentUser.email,
      points:firebase.firestore.FieldValue.increment(score),
      streak:streak
    },{merge:true});

    alert("AI Score: "+score+" points awarded!");
  });
}

// Load User
function loadUserData(){
  db.collection("users").doc(currentUser.uid)
  .onSnapshot(doc=>{
    const data=doc.data();
    if(!data) return;

    welcome.innerHTML="Welcome, "+data.email;
    points.innerText=data.points||0;
    streak.innerText=data.streak||0;

    let badgeHTML="";
    if(data.points>=100) badgeHTML+='<span class="badge">Rising Coder</span>';
    if(data.points>=300) badgeHTML+='<span class="badge">Elite Developer</span>';
    if(data.points>=600) badgeHTML+='<span class="badge">Africa Finalist</span>';
    badges.innerHTML=badgeHTML;
  });
}

// Leaderboard
function loadLeaderboard(){
  db.collection("users")
  .orderBy("points","desc")
  .limit(20)
  .onSnapshot(snapshot=>{
    let html="";
    let i=0;
    snapshot.forEach(doc=>{
      const d=doc.data();
      i++;
      let cls="";
      if(i==1) cls="rank-1";
      if(i==2) cls="rank-2";
      if(i==3) cls="rank-3";

      html+=`
      <div class="leader-row ${cls}">
        <span>${i}. ${d.email}</span>
        <span>${d.points||0} pts</span>
      </div>`;
    });
    leaderboard.innerHTML=html;
  });
}
</script>

</body>
</html>
