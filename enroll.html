<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>CODEON Uganda | Enroll</title>

<!-- QR + PDF -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>

<!-- Flutterwave -->
<script src="https://checkout.flutterwave.com/v3.js"></script>

<!-- Firebase (only once) -->
<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>

<style>
body{font-family:Arial;margin:0;background:#f4f4f4}
header{background:#111;color:#fff;padding:15px;text-align:center}
nav{background:#222;padding:10px;text-align:center}
nav a{color:white;margin:0 15px;text-decoration:none;font-weight:bold}
section{padding:40px 20px;max-width:1000px;margin:auto}
.hero{background:#000;color:white;text-align:center;padding:60px 20px}
.cards{display:flex;flex-wrap:wrap;gap:20px}
.card{flex:1;min-width:250px;background:white;padding:20px;border-radius:8px}
button{padding:10px 20px;background:#111;color:white;border:none;cursor:pointer;margin-top:10px}
button:hover{background:#333}
input,select{width:100%;padding:10px;margin:8px 0}
footer{background:#111;color:white;text-align:center;padding:20px}
.certificate{display:none;border:8px solid #111;padding:40px;text-align:center;background:white;margin-top:20px;}
</style>
</head>
<body>

<header>
<h1>CODEON Uganda</h1>
<p>Code Your Future</p>
</header>

<nav>
<a href="index.html">Home</a>
<a href="enroll.html">Enroll</a>
<a href="verify.html">Verify Certificate</a>
</nav>

<section id="enroll">
<h2>Enroll Now</h2>

<input type="text" id="enrollName" placeholder="Full Name" required>
<input type="email" id="enrollEmail" placeholder="Email" required>

<select id="enrollLevel">
<option value="Level 1">Level 1 â€“ Free</option>
<option value="Level 2">Level 2 â€“ Free</option>
<option value="Level 3">Level 3 â€“ UGX 50,000</option>
</select>

<button type="button" id="enrollBtn">Enroll</button>

<h3>Optional Certificate Payment (Level 3)</h3>
<button type="button" id="payBtn">Pay for Certificate</button>

</section>

<section class="certificate" id="certificate">
<h2>Certificate of Completion</h2>
<p>Name: <span id="certName"></span></p>
<p>Level: <span id="certLevelDisplay"></span></p>
<p>ID: <span id="certID"></span></p>
<p>Signature: <span id="certHash"></span></p>
<div id="qrcode"></div>
<button onclick="downloadPDF()">Download PDF</button>
</section>

<footer>
Â© 2026 CODEON Uganda
</footer>

<script>
// ðŸ”¥ Firebase Config
const firebaseConfig = {
  apiKey: "AIzaSyD_LR9Kllj7hoKTiJAaSxyHglSO6r5gh-g",
  authDomain: "codeon-3cb1c.firebaseapp.com",
  projectId: "codeon-3cb1c",
  storageBucket: "codeon-3cb1c.appspot.com",
  messagingSenderId: "730172148868",
  appId: "1:730172148868:web:2c712c8124be40019506d1"
};

firebase.initializeApp(firebaseConfig);
const db = firebase.firestore();

// âœ… Enrollment
async function enrollStudent(){
  const name = document.getElementById("enrollName").value;
  const email = document.getElementById("enrollEmail").value;
  const level = document.getElementById("enrollLevel").value;

  if(!name || !email){
    alert("Please fill all fields");
    return;
  }

  try {
    const docRef = await db.collection("students").add({
      name,
      email,
      level,
      paid: false,
      createdAt: new Date()
    });

    console.log("Saved with ID:", docRef.id);
    alert("Enrollment Successful!");
  } catch(error){
    console.error(error);
    alert("Error: "+error.message);
  }
}

// âœ… Certificate Generator
async function generateCertificate(name, level){
  const id = "CODEON-" + Date.now();
  const data = name + level + id;
  const hashBuffer = await crypto.subtle.digest("SHA-256", new TextEncoder().encode(data));
  const hashArray = Array.from(new Uint8Array(hashBuffer));
  const hash = hashArray.map(b=>b.toString(16).padStart(2,"0")).join("").substring(0,16);

  await db.collection("certificates").doc(id).set({name, level, id, hash});

  document.getElementById("certName").innerText = name;
  document.getElementById("certLevelDisplay").innerText = level;
  document.getElementById("certID").innerText = id;
  document.getElementById("certHash").innerText = hash;
  document.getElementById("certificate").style.display = "block";

  document.getElementById("qrcode").innerHTML = "";
  new QRCode(document.getElementById("qrcode"),{
    text: window.location.href+"?verify="+id,
    width:120,
    height:120
  });
}

// âœ… PDF Download
function downloadPDF(){
  html2pdf().from(document.getElementById("certificate")).save();
}

// âœ… Flutterwave Payment
function payCertificate(){
  const name = document.getElementById("enrollName").value;
  const level = document.getElementById("enrollLevel").value;

  if(!name){
    alert("Enter name before paying");
    return;
  }

  FlutterwaveCheckout({
    public_key: "YOUR_FLUTTERWAVE_PUBLIC_KEY",
    tx_ref: "CODEON-"+Date.now(),
    amount: 50000,
    currency: "UGX",
    payment_options: "card,mobilemoneyuganda",
    customer: {email: document.getElementById("enrollEmail").value || "student@email.com"},
    callback: function(data){
      alert("Payment Successful!");
      generateCertificate(name, level);
      // Mark student as paid
      db.collection("students").where("email", "==", document.getElementById("enrollEmail").value)
        .get().then(snapshot=>{
          snapshot.forEach(doc=>{
            doc.ref.update({paid:true});
          });
        });
    },
    customizations: {
      title: "CODEON Certificate Payment",
      description: "Payment for course certificate",
      logo: ""
    }
  });
}

// âœ… Button Event Listeners
document.getElementById("enrollBtn").addEventListener("click", enrollStudent);
document.getElementById("payBtn").addEventListener("click", payCertificate);

</script>
</body>
</html>













