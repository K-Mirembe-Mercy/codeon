<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>CODEON Uganda | Enroll</title>

<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>

<style>
body{font-family:Arial;background:#f4f4f4;text-align:center;padding:40px}
input,select{padding:10px;width:300px;margin:10px}
button{padding:12px 20px;background:black;color:white;border:none;cursor:pointer}
</style>
</head>
<body>

<h2>Enroll at CODEON Uganda</h2>

<input type="text" id="name" placeholder="Full Name"><br>
<input type="email" id="email" placeholder="Email"><br>

<select id="level">
<option value="Level 1">Level 1 â€“ Free</option>
<option value="Level 2">Level 2 â€“ Free</option>
<option value="Level 3">Level 3 â€“ UGX 50,000</option>
</select><br>

<button onclick="enroll()">Enroll</button>

<script>
// ðŸ”¥ Your Firebase config
const firebaseConfig = {
  apiKey: "AIzaSyD_LR9Kllj7hoKTiJAaSxyHglSO6r5gh-g",
  authDomain: "codeon-3cb1c.firebaseapp.com",
  projectId: "codeon-3cb1c",
  storageBucket: "codeon-3cb1c.appspot.com",
  messagingSenderId: "730172148868",
  appId: "1:730172148868:web:2c712c8124be40019506d1"
};

firebase.initializeApp(firebaseConfig);
const db = firebase.firestore();

async function enroll(){

const name = document.getElementById("name").value.trim();
const email = document.getElementById("email").value.trim();
const level = document.getElementById("level").value;

if(!name || !email){
alert("Fill all fields");
return;
}

// Save student
const docRef = await db.collection("students").add({
name,
email,
level,
paid: level === "Level 3" ? false : true,
createdAt: new Date()
});

// FREE LEVELS
if(level === "Level 1"){
window.location.href = "level1.html";
return;
}

if(level === "Level 2"){
window.location.href = "level2.html";
return;
}

// LEVEL 3 PAYMENT
if(level === "Level 3"){

const paymentWindow = window.open(
"https://store.pesapal.com/level3",
"_blank",
"width=600,height=700"
);

const checkPayment = setInterval(async function(){

if(paymentWindow.closed){
clearInterval(checkPayment);

// Mark paid
await db.collection("students").doc(docRef.id).update({
paid:true
});

alert("Payment Successful! Welcome to Level 3");

// Save session locally
localStorage.setItem("codeonUser", email);

window.location.href = "level3.html";
}

},1000);
}

}
</script>

</body>
</html>
