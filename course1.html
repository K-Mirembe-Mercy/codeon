<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>CODEON ‚Äì HTML Foundations & Deployment</title>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>

<!-- Monaco Editor -->
<script src="https://cdn.jsdelivr.net/npm/monaco-editor@0.44.0/min/vs/loader.js"></script>

<style>
body{margin:0;font-family:'Segoe UI',sans-serif;background:linear-gradient(135deg,#0f2027,#203a43,#2c5364);color:white;transition:.3s;}
header{background:#111;padding:20px;text-align:center;position:sticky;top:0;z-index:10;}
header h1{margin:0;font-size:1.8em;}
header .progress-container{background:#333;border-radius:12px;height:14px;margin-top:10px;}
header .progress-bar{background:gold;height:14px;width:0%;border-radius:12px;transition:.5s;}
header #pointsDisplay{margin-top:5px;}
nav{display:flex;justify-content:center;gap:15px;margin-top:10px;}
nav a{color:white;text-decoration:none;font-weight:bold;transition:.3s;}
nav a:hover{color:gold;}
#confetti{position:fixed;top:0;left:0;width:100%;height:100%;pointer-events:none;z-index:9999;}
section{padding:20px;max-width:1000px;margin:0 auto;}
.card{background:rgba(255,255,255,0.08);padding:20px;border-radius:12px;margin-bottom:20px;transition:.3s;}
.locked{opacity:0.4;pointer-events:none;}
button{padding:10px 20px;background:gold;color:black;border:none;border-radius:6px;font-weight:bold;cursor:pointer;margin-top:10px;transition:.3s;}
button:hover{background:orange;}
#editor{height:300px;border:1px solid #ccc;margin-top:10px;border-radius:6px;}
iframe{width:100%;height:250px;border:1px solid black;margin-top:10px;border-radius:6px;}
.badge{display:inline-block;padding:4px 8px;background:#ffda59;color:black;border-radius:6px;margin-right:4px;font-weight:bold;animation:pulse 1.2s infinite;}
@keyframes pulse{0%,100%{opacity:1;}50%{opacity:0.6;}}
.leader-row{display:flex;justify-content:space-between;padding:6px;border-bottom:1px solid #ccc;transition:.3s;}
.leader-row:hover{transform:scale(1.02);}
@media(max-width:600px){#editor{height:200px;}.leader-row{flex-direction:column;}}
textarea,input,select{width:100%;padding:10px;margin:5px 0;border-radius:5px;}
h2,h3{margin-top:0;}
.protip{background:rgba(255,255,0,0.1);padding:10px;border-left:4px solid gold;margin:10px 0;border-radius:6px;}
.preview-frame{height:400px;border:2px solid gold;border-radius:8px;margin-top:10px;}
.feedback{background:rgba(0,0,0,0.2);padding:10px;margin-top:10px;border-radius:6px;color:#ffda59;}
</style>
</head>
<body>

<header>
<h1>CODEON ‚Äì HTML Foundations & Deployment</h1>
<div class="progress-container"><div class="progress-bar" id="progressBar"></div></div>
<p id="pointsDisplay">Points: 0</p>
<nav>
  <a href="#course">Course</a>
  <a href="#challenge">Weekly Challenge</a>
  <a href="#leaderboard">Leaderboard</a>
</nav>
</header>

<div id="confetti"></div>

<section id="authSection" class="card">
<h2>Login / Sign Up</h2>
<input type="email" id="email" placeholder="Email">
<input type="password" id="password" placeholder="Password">
<input type="text" id="school" placeholder="School Name">
<select id="country">
  <option value="Uganda">Uganda</option>
  <option value="Kenya">Kenya</option>
  <option value="Nigeria">Nigeria</option>
  <option value="Ghana">Ghana</option>
  <option value="South Africa">South Africa</option>
</select>
<button onclick="signup()">Sign Up</button>
<button onclick="login()">Login</button>
</section>

<section id="main" style="display:none;">

<div id="course" class="card">
<h2>üìö Course 1 ‚Äì HTML Foundations</h2>

<div class="lesson" id="lesson1">
<h3>Lesson 1 ‚Äì HTML Structure</h3>
<div class="protip"><b>Concepts:</b> HTML is the skeleton of web pages. DOCTYPE declares HTML5. &lt;html&gt; is root, &lt;head&gt; contains metadata, &lt;body&gt; has visible content.</div>
<p>Task: Change "Your Name" to your real name in the &lt;h1&gt; tag.</p>
<div id="editor"></div>
<button onclick="runCode()">Run Code</button>
<button onclick="checkLesson(1)">Submit Lesson 1</button>

<p>Submit your GitHub repo URL for bonus points:</p>
<input type="url" id="github1" placeholder="https://github.com/username/repo">
<button onclick="submitGithub(1)">Submit GitHub Repo</button>

<p>Preview your GitHub Pages:</p>
<input type="url" id="githubPages1" placeholder="https://username.github.io/repo">
<button onclick="previewGitHub(1)">Preview</button>
<iframe id="preview1" class="preview-frame"></iframe>

<iframe id="output"></iframe>
<p id="status1"></p>
<div class="protip">üí° Pro Tip: Deploying to GitHub Pages builds your portfolio and impresses recruiters.</div>
<div id="feedback1" class="feedback"></div>
</div>

</div>

<div id="challenge" class="card">
<h2>üî• Weekly Challenge</h2>
<p>Constraint: Build a landing page without using &lt;table&gt; tags.</p>
<textarea id="challengeCode" placeholder="Write your HTML/CSS here..."></textarea>
<button onclick="submitChallenge()">Submit Challenge</button>
<div class="protip">üí° Push challenge to GitHub to gain visibility and real-world practice!</div>
<div id="challengeFeedback" class="feedback"></div>
</div>

<div id="leaderboard" class="card">
<h2>üèÜ Africa Leaderboard</h2>
<div id="leaderboardBoard"></div>
</div>

</section>

<script>
// Firebase
const firebaseConfig = {
  apiKey: "AIzaSyD_LR9Kllj7hoKTiJAaSxyHglSO6r5gh-g",
  authDomain: "codeon-3cb1c.firebaseapp.com",
  projectId: "codeon-3cb1c"
};
firebase.initializeApp(firebaseConfig);
const auth=firebase.auth();
const db=firebase.firestore();
let currentUser=null;

// Monaco Editor
require.config({ paths: { vs: 'https://cdn.jsdelivr.net/npm/monaco-editor@0.44.0/min/vs' }});
require(['vs/editor/editor.main'], function() {
window.editor = monaco.editor.create(document.getElementById('editor'), {
value: `<!DOCTYPE html>
<html>
<head>
<title>My First Website</title>
</head>
<body>
<h1>Your Name</h1>
<p>I want to become a Developer.</p>
<footer>¬© 2026 CODEON Uganda</footer>
</body>
</html>`,
language: 'html',
theme: 'vs-dark'
});
});

function runCode(){document.getElementById("output").srcdoc=editor.getValue();}

// Points & progress
let totalPoints=0;
function updateProgress(){
  let progress=(totalPoints/600)*100;
  if(progress>100) progress=100;
  document.getElementById("progressBar").style.width=progress+"%";
  document.getElementById("pointsDisplay").innerText="Points: "+totalPoints;
}

// Lesson checking + AI-style feedback
function checkLesson(lesson){
  let code=editor.getValue().toLowerCase();
  let status=document.getElementById("status"+lesson);
  let feedback=document.getElementById("feedback"+lesson);
  let valid=false;
  let pointsEarned=0;
  let msgs=[];
  switch(lesson){
    case 1: 
      if(code.includes("<h1>") && !code.includes("your name")){
        valid=true;
        pointsEarned=50;
      }else{
        msgs.push("‚ùå Remember to replace 'Your Name' in <h1> with your real name.");
      }
      if(!code.includes("<footer>")) msgs.push("üí° Tip: Add a <footer> to show page ownership.");
      if(!code.includes("<p>")) msgs.push("üí° Tip: Add a <p> paragraph describing yourself or your goals.");
      break;
  }
  feedback.innerHTML=msgs.join("<br>");
  if(valid){
    status.innerHTML="‚úÖ Lesson "+lesson+" Complete! üéâ";
    totalPoints+=pointsEarned;
    updateProgress();
    if(currentUser) db.collection("users").doc(currentUser.uid).update({points:totalPoints});
    triggerConfetti();
  }else{
    status.innerHTML="‚ùå Complete the task correctly. See AI tips below.";
  }
}

// Confetti
function triggerConfetti(){
  const confetti=document.getElementById("confetti");
  for(let i=0;i<100;i++){
    let el=document.createElement("div");
    el.style.position="absolute";
    el.style.width="8px"; el.style.height="8px";
    el.style.background=["gold","orange","yellow"][Math.floor(Math.random()*3)];
    el.style.top=Math.random()*window.innerHeight+"px";
    el.style.left=Math.random()*window.innerWidth+"px";
    el.style.opacity=Math.random();
    confetti.appendChild(el);
    setTimeout(()=>el.remove(),2000);
  }
}

// GitHub submission validation
async function submitGithub(lesson){
  const input=document.getElementById("github"+lesson);
  const url=input.value.trim();
  if(!url.startsWith("https://github.com/")) {alert("Enter valid GitHub URL."); return;}
  try{
    let apiURL=url.replace("https://github.com/","https://api.github.com/repos/");
    let resp=await fetch(apiURL);
    if(resp.ok){
      alert("üéâ Verified GitHub repo! +20 bonus points");
      totalPoints+=20;
      updateProgress();
      if(currentUser) db.collection("users").doc(currentUser.uid).update({points:totalPoints,["githubLesson"+lesson]:url});
      input.value="";
    }else alert("‚ùå Repo not found. Check URL or privacy settings.");
  }catch(e){alert("Error validating repo.");}
}

// GitHub Pages preview
function previewGitHub(lesson){
  const input=document.getElementById("githubPages"+lesson);
  const url=input.value.trim();
  if(!url.startsWith("https://")) {alert("Enter valid GitHub Pages URL."); return;}
  document.getElementById("preview"+lesson).src=url;
}

// Firebase Auth
function signup(){
  auth.createUserWithEmailAndPassword(email.value,password.value)
  .then(u=>{
    db.collection("users").doc(u.user.uid).set({
      email:email.value,
      school:school.value,
      country:country.value,
      points:0
    });
  }).catch(alert);
}
function login(){auth.signInWithEmailAndPassword(email.value,password.value).catch(alert);}
function logout(){auth.signOut();}
auth.onAuthStateChanged(user=>{
  if(user){
    currentUser=user;
    authSection.style.display="none";
    main.style.display="block";
    loadLeaderboard();
  }else{
    authSection.style.display="block";
    main.style.display="none";
  }
});

// Weekly Challenge
function submitChallenge(){
  let code=challengeCode.value;
  let score=Math.floor(Math.random()*50)+50;
  totalPoints+=score;
  updateProgress();
  document.getElementById("challengeFeedback").innerHTML="üéØ AI Feedback: Nice work! You earned "+score+" points.";
  if(currentUser) db.collection("users").doc(currentUser.uid).update({points:totalPoints});
}

// Leaderboard
function loadLeaderboard(){
  db.collection("users").get().then(snap=>{
    let html="";
    snap.forEach(doc=>{
      let d=doc.data();
      html+=`<div class="leader-row"><span>${d.email}</span><span>${d.points||0} pts</span></div>`;
    });
    leaderboardBoard.innerHTML=html;
  });
}

// Persist points
window.onload=function(){
  if(localStorage.getItem("totalPoints")){
    totalPoints=parseInt(localStorage.getItem("totalPoints"));
    updateProgress();
  }
};
window.onbeforeunload=function(){localStorage.setItem("totalPoints",totalPoints);};
</script>

</body>
</html>
